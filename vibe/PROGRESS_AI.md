# AI Novel Studio - AI åŠŸèƒ½å¼€å‘è¿›åº¦

> æœ€åæ›´æ–°: 2026-01-06

## æ¦‚è¿°

æœ¬æ–‡æ¡£è¿½è¸ª AI åŠŸèƒ½çš„å¼€å‘è¿›åº¦ã€‚è¯¦ç»†éœ€æ±‚è§ `PRD_AI.md`ï¼ŒæŠ€æœ¯æ¶æ„è§ `ARCHITECTURE.md`ã€‚

### æ ¸å¿ƒç›®æ ‡

1. **Provider æ¶æ„** - æ”¯æŒ SiliconFlowã€Geminiï¼Œå¯æ‰©å±•
2. **ç»Ÿä¸€æ¶ˆæ¯æµ** - æ‰€æœ‰äº¤äº’éƒ½æ˜¯æ¶ˆæ¯ï¼Œç±»å‹ä¸åŒ
3. **ä¸‰å¤§åŠŸèƒ½** - ä¿®æ”¹ï¼ˆæ¶¦è‰²/æ‰©å†™/ç¼©å†™ï¼‰ã€ç”Ÿæˆï¼ˆç»­å†™/è§„åˆ’/æ€»ç»“ï¼‰ã€èŠå¤©
4. **èŠå¤©æµ®çª—** - å§‹ç»ˆå¯ç”¨çš„ AI äº¤äº’ç•Œé¢

### æ”¯æŒæ¨¡å‹

| æœåŠ¡å•† | æ¨¡å‹ |
|--------|------|
| SiliconFlow | Pro/deepseek-ai/DeepSeek-V3.2 |
| Google Gemini | gemini-3-pro-preview, gemini-3-flash-preview |

---

## æ•´ä½“è¿›åº¦

| é˜¶æ®µ | çŠ¶æ€ | å®Œæˆåº¦ |
|------|------|--------|
| Phase 1: Provider æ¶æ„ | âœ… å·²å®Œæˆ | 100% |
| Phase 2: AI è®¾ç½®ç•Œé¢ | âœ… å·²å®Œæˆ | 100% |
| Phase 3: èŠå¤©æµ®çª— | âœ… å·²å®Œæˆ | 100% |
| Phase 4: ä¿®æ”¹åŠŸèƒ½ | âœ… å·²å®Œæˆ | 100% |
| Phase 5: ç”ŸæˆåŠŸèƒ½ | âœ… å·²å®Œæˆ | 100% |
| Phase 6: ç ´é™æ¨¡å¼ | ğŸ”² æœªå¼€å§‹ | 0% |
| Phase 7: ä¼˜åŒ–ä¸æ”¶å°¾ | ğŸ”² æœªå¼€å§‹ | 0% |

---

## Phase 1: Provider æ¶æ„ âœ…

> æ­å»ºå¯æ‰©å±•çš„ AI Provider ç³»ç»Ÿ

- [x] åˆ›å»º `src/lib/ai/` ç›®å½•ç»“æ„
- [x] å®šä¹‰ AI ç›¸å…³ç±»å‹ (`types/`)
- [x] åˆ›å»º Provider æŠ½è±¡åŸºç±» (`providers/base.ts`)
- [x] å®ç° SiliconFlow Provider
- [x] å®ç° Gemini Provider
- [x] åˆ›å»º Provider æ³¨å†Œè¡¨
- [x] åˆ›å»ºç»Ÿä¸€ API è·¯ç”± (`POST /api/ai/chat`)

---

## Phase 2: AI è®¾ç½®ç•Œé¢ âœ…

> ç”¨æˆ·é…ç½® API Key å’Œæ¨¡å‹åå¥½

- [x] åˆ›å»ºè®¾ç½®å­˜å‚¨ (`settings.ts`)
- [x] åˆ›å»º AI Store (`ai-store.ts`)
- [x] åˆ›å»ºè®¾ç½®é¡µé¢ (`/settings`)
- [x] å®ç° Provider åˆ—è¡¨ UI
- [x] å®ç° API Key è¾“å…¥ + æµ‹è¯•è¿æ¥
- [x] å®ç°åŠŸèƒ½æ¨¡å‹é…ç½® UI

---

## Phase 3: èŠå¤©æµ®çª— âœ…

> æ ¸å¿ƒäº¤äº’ç•Œé¢ï¼Œæ”¯æŒæ”¶èµ·/å±•å¼€

- [x] åˆ›å»ºæµ®çª—å®¹å™¨ (`ai-chat-window.tsx`)
- [x] å®ç°æ”¶èµ·/å±•å¼€çŠ¶æ€
- [x] åˆ›å»ºæ¶ˆæ¯åˆ—è¡¨ (`ai-chat-messages.tsx`)
- [x] åˆ›å»ºæ¶ˆæ¯æ¸²æŸ“å™¨ (`message-renderer.tsx`)
- [x] åˆ›å»ºè¾“å…¥åŒºåŸŸ (`ai-chat-input.tsx`)
- [x] å®ç° Pending Tag æ˜¾ç¤ºï¼ˆç‰¹æ®ŠåŠŸèƒ½è§¦å‘åæ˜¾ç¤ºåœ¨è¾“å…¥æ¡†ï¼‰
- [x] åˆ›å»ºä¸Šä¸‹æ–‡æ ‡ç­¾ (`ai-context-tags.tsx`)
- [x] åˆ›å»ºä¸Šä¸‹æ–‡é€‰æ‹©å™¨ (`ai-context-selector.tsx`)
- [x] é›†æˆåˆ°ç¼–è¾‘å™¨å¸ƒå±€
- [x] å®ç°å…¨å±€å¿«æ·é”®å‘¼å‡º (`Ctrl+Shift+A`)

---

## Phase 4: ä¿®æ”¹åŠŸèƒ½ âœ…

> æ¶¦è‰²ã€æ‰©å†™ã€ç¼©å†™

- [x] åˆ›å»ºç»Ÿä¸€ Prompt æ¨¡æ¿ (`prompts/unified.ts`)
- [x] åˆ›å»ºå³é”®èœå• (`ai-context-menu.tsx`)
- [x] åˆ›å»ºè¯·æ±‚å¡ç‰‡ (`ai-special-request-card.tsx`)
- [x] åˆ›å»ºç»“æœå¡ç‰‡ (`ai-modify-result-card.tsx`)
- [x] åˆ›å»ºä¸Šä¸‹æ–‡æ„å»ºå™¨ (`context-builder.ts`)
- [x] å®ç° AI è¯·æ±‚ Hook (`use-ai-request.ts`)
- [x] å®ç°ç¼–è¾‘å™¨ç›‘å¬åº”ç”¨ä¿®æ”¹äº‹ä»¶
- [x] æµ‹è¯•ä¿®æ”¹åŠŸèƒ½

---

## Phase 5: ç”ŸæˆåŠŸèƒ½ ğŸ”„

> è§„åˆ’ã€ç»­å†™ã€æ€»ç»“

### 5.1 è§„åˆ’åŠŸèƒ½ âœ…

- [x] å®ç°è§„åˆ’ Prompt
- [x] å®ç°è§„åˆ’ä¸Šä¸‹æ–‡æ„å»º (`buildPlanContext`)
- [x] åˆ›å»ºè§„åˆ’ç»“æœå¡ç‰‡ (`ai-plan-result-card.tsx`)
- [x] åœ¨æ–‡ä»¶å¤¹ç¼–è¾‘å™¨æ·»åŠ  AI è§„åˆ’æŒ‰é’®
- [x] å®ç°æ‰¹é‡åˆ›å»ºå­èŠ‚ç‚¹
- [x] æµ‹è¯•è§„åˆ’åŠŸèƒ½

### 5.2 ç»­å†™åŠŸèƒ½ âœ…

- [x] å®šä¹‰ç»­å†™ç±»å‹å’Œ Payload (`ContinuePayload`, `ContinueResult`)
- [x] å®ç°ç»­å†™ä¸Šä¸‹æ–‡æ„å»º (`buildContinueContext`)
- [x] å®ç°ç»­å†™ Prompt å’Œ Payload æ ¼å¼åŒ–
- [x] åˆ›å»ºç»­å†™ç»“æœå¡ç‰‡ (`ai-continue-result-card.tsx`)
- [x] å®ç°ç¼–è¾‘å™¨ Tab é”®è§¦å‘ç»­å†™
- [x] å®ç°ç»“æœæ’å…¥åˆ°ç¼–è¾‘å™¨ (`ai-apply-continue` äº‹ä»¶)
- [x] æµ‹è¯•ç»­å†™åŠŸèƒ½

### 5.3 æ€»ç»“åŠŸèƒ½ âœ…

- [x] æ‰©å±• `SummarizePayload` ç±»å‹ï¼ˆæ”¯æŒèŠ‚ç‚¹åç§°ã€ç±»å‹ã€å½“å‰æ‘˜è¦ï¼‰
- [x] å®ç°æ€»ç»“ä¸Šä¸‹æ–‡æ„å»º (`buildSummarizeContext`)
- [x] å®ç°æ€»ç»“ Prompt å’Œ Payload æ ¼å¼åŒ–
- [x] åˆ›å»ºæ€»ç»“ç»“æœå¡ç‰‡ (`ai-summarize-result-card.tsx`)
- [x] åœ¨æ–‡æ¡£ç¼–è¾‘å™¨æ·»åŠ  AI æ€»ç»“æŒ‰é’®ï¼ˆåœºæ™¯æ‘˜è¦æ—ï¼‰
- [x] åœ¨æ–‡ä»¶å¤¹ç¼–è¾‘å™¨æ·»åŠ  AI æ€»ç»“æŒ‰é’®ï¼ˆå¤§çº²æ—ï¼‰
- [x] å®ç°ç»“æœåº”ç”¨åˆ° summary/outline å­—æ®µ (`ai-apply-summarize` äº‹ä»¶)
- [x] æµ‹è¯•æ€»ç»“åŠŸèƒ½

### 5.4 æ™®é€šèŠå¤© âœ…

- [x] å®ç°è‡ªç”±å¯¹è¯
- [x] å®ç°å¯¹è¯å†å²ç®¡ç†
- [x] å®ç°å‚è€ƒå†…å®¹æ˜¾ç¤º
- [x] æµ‹è¯•èŠå¤©åŠŸèƒ½

---

## Phase 6: ç ´é™æ¨¡å¼ ğŸ”²

> ä¸‰é‡æœºåˆ¶å®ç°ç¨³å®šç ´é™

- [ ] åˆ›å»ºç ´é™ Prompt (`jailbreak.ts`)
- [ ] å®ç°ç ´é™ System Prompt åˆ‡æ¢
- [ ] å®ç°ç”¨æˆ·æ¶ˆæ¯è‡ªåŠ¨æ³¨å…¥å’’è¯­
- [ ] å®ç° AI å›å¤é¢„å¡«å……æ³¨å…¥
- [ ] å®ç°ç ´é™ UIï¼ˆå¼€å…³ã€çŠ¶æ€æç¤ºï¼‰
- [ ] æµ‹è¯•å„åŠŸèƒ½çš„ç ´é™æ•ˆæœ

---

## Phase 7: ä¼˜åŒ–ä¸æ”¶å°¾ ğŸ”²

- [ ] å®ç°è¯·æ±‚é˜Ÿåˆ—ï¼ˆé¿å…å¹¶å‘ï¼‰
- [ ] å®ç°è¯·æ±‚å–æ¶ˆä¼˜åŒ–
- [ ] å®ç°ç»Ÿä¸€é”™è¯¯å¤„ç†
- [ ] å®ç°èŠå¤©å†å²æŒä¹…åŒ–
- [ ] ä¼˜åŒ–ç§»åŠ¨ç«¯ä½“éªŒ
- [ ] å…¨æµç¨‹æµ‹è¯•

---

## å½“å‰æ–‡ä»¶ç»“æ„

```
src/lib/ai/
â”œâ”€â”€ index.ts
â”œâ”€â”€ settings.ts
â”œâ”€â”€ context-builder.ts
â”œâ”€â”€ types/
â”‚   â”œâ”€â”€ index.ts
â”‚   â”œâ”€â”€ message.ts          # ç»Ÿä¸€æ¶ˆæ¯ç±»å‹
â”‚   â”œâ”€â”€ context.ts
â”‚   â”œâ”€â”€ function.ts
â”‚   â”œâ”€â”€ provider.ts
â”‚   â””â”€â”€ settings.ts
â”œâ”€â”€ prompts/
â”‚   â”œâ”€â”€ index.ts
â”‚   â””â”€â”€ unified.ts          # ç»Ÿä¸€ Prompt æ„å»º
â”œâ”€â”€ providers/
â”‚   â”œâ”€â”€ index.ts
â”‚   â”œâ”€â”€ base.ts
â”‚   â”œâ”€â”€ gemini.ts
â”‚   â””â”€â”€ siliconflow.ts
â””â”€â”€ hooks/
    â”œâ”€â”€ index.ts
    â””â”€â”€ use-ai-request.ts

src/components/ai/
â”œâ”€â”€ index.ts
â”œâ”€â”€ ai-chat-window.tsx
â”œâ”€â”€ ai-chat-input.tsx
â”œâ”€â”€ ai-chat-messages.tsx
â”œâ”€â”€ message-renderer.tsx
â”œâ”€â”€ ai-context-tags.tsx
â”œâ”€â”€ ai-context-selector.tsx
â”œâ”€â”€ ai-context-menu.tsx
â”œâ”€â”€ ai-modify-result-card.tsx
â”œâ”€â”€ ai-plan-result-card.tsx
â”œâ”€â”€ ai-continue-result-card.tsx
â”œâ”€â”€ ai-summarize-result-card.tsx
â”œâ”€â”€ ai-special-request-card.tsx
â””â”€â”€ ai-debug-panel.tsx
```

---

## å˜æ›´æ—¥å¿—

| æ—¥æœŸ | å˜æ›´å†…å®¹ |
|------|----------|
| 2026-01-06 | å®Œæˆ Phase 5.3: æ€»ç»“åŠŸèƒ½ï¼ˆæ–‡æ¡£/æ–‡ä»¶å¤¹æ‘˜è¦ç”Ÿæˆï¼‰ |
| 2026-01-06 | å®Œæˆ Phase 5.2: ç»­å†™åŠŸèƒ½ï¼ˆTab é”®è§¦å‘ã€ç»“æœå¡ç‰‡ã€æ’å…¥ç¼–è¾‘å™¨ï¼‰ |
| 2026-01-06 | ä»£ç æ¸…ç†ï¼šåˆ é™¤æ—§ handlersã€æ—§ promptsã€æ—§ result-card |
| 2026-01-06 | é‡æ„æ–‡æ¡£ï¼šåˆ é™¤ DECISIONS.mdï¼Œåˆ›å»º ARCHITECTURE.md |
| 2026-01-06 | å®Œæˆ Phase 5.1: è§„åˆ’åŠŸèƒ½ |
| 2026-01-05 | å®Œæˆ Phase 4: ä¿®æ”¹åŠŸèƒ½ |
| 2026-01-05 | å®ç°ç»Ÿä¸€æ¶ˆæ¯æµæ¶æ„ |
| 2026-01-05 | å®ç° Pending Tag äº¤äº’æ–¹æ¡ˆ |
| 2026-01-04 | å®Œæˆ Phase 1-3: Providerã€è®¾ç½®ã€èŠå¤©æµ®çª— |
